{% extends "base.html" %}
{% block title %}Riwayat Mood - PodMatch{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- HEADER + CLEAR BUTTON -->
    <div class="d-flex justify-content-between align-items-end mb-2">
        <div>
            <h1 class="text-white fw-bold history-title mb-4">Riwayat Podcast Kamu</h1>
            <p class="text-light">Semua hasil analisis mood yang pernah kamu lakukan akan muncul di sini.</p>
        </div>

        <button class="btn btn-danger clear-history-btn" onclick="confirmClear()">
            <ion-icon name="trash-outline"></ion-icon> Hapus Riwayat
        </button>
    </div>

    <div class="row g-4" id="historyContainer">
        <!-- Data dari JavaScript -->
    </div>
</div>

<script>

    /* ========== POPUP KONFIRMASI CLEAR HISTORY ========== */
    function confirmClear() {
        const confirmBox = document.createElement("div");
        confirmBox.className = "confirm-overlay fade-in";
        confirmBox.innerHTML = `
            <div class="confirm-box premium-popup scale-in">
                <h3 class="fw-bold mb-2">Hapus Semua Riwayat?</h3>
                <p class="text-light mb-3">Aksi ini tidak dapat dibatalkan. Yakin ingin melanjutkan?</p>

                <div class="popup-buttons">
                    <button class="btn btn-outline-light btn-sm" id="cancelClear">Batal</button>
                    <button class="btn btn-danger btn-sm" id="doClear">Hapus</button>
                </div>
            </div>
        `;
        document.body.appendChild(confirmBox);

        document.getElementById("cancelClear").onclick = () => {
            confirmBox.classList.remove("fade-in");
            confirmBox.classList.add("fade-out");
            setTimeout(() => confirmBox.remove(), 200);
        };

        document.getElementById("doClear").onclick = () => {
            localStorage.removeItem("podmatch_history");
            confirmBox.remove();
            location.reload();
        };
    }

    /* ========== LOAD HISTORY ========== */
    function loadHistory() {
        const container = document.getElementById("historyContainer");

        let history = localStorage.getItem("podmatch_history");
        if (!history) {
            container.innerHTML = `<p class="text-white">Belum ada riwayat.</p>`;
            return;
        }

        history = JSON.parse(history);

        if(history.length === 0){
            container.innerHTML = `<p class="text-white">Belum ada riwayat.</p>`;
            return;
        }

        history.forEach(item => {
            const moodClass =
                item.mood === "Senang" ? "mood-happy" :
                item.mood === "Sedih" ? "mood-sad" :
                item.mood === "Marah" ? "mood-anger" :
                item.mood === "Takut" ? "mood-fear" :
                item.mood === "Kasih" ? "mood-love" : "mood-neutral";

            container.innerHTML += `
                <div class="col-md-6 col-lg-4">
                    <div class="history-card">

                        <div class="thumbnail-box">
                            <a href="${item.video_url}" target="_blank">
                                <img src="${item.video_thumbnail}" class="thumbnail-img">
                                <div class="play-btn">
                                    <ion-icon name="play"></ion-icon>
                                </div>
                            </a>
                        </div>

                        <div class="d-flex justify-content-between mt-3 text-light small">
                            <span>${item.date}</span>

                            <span class="badge ${moodClass}">
                                ${item.mood}
                            </span>
                        </div>

                        <h5 class="mt-2 text-white">${item.video_title}</h5>

                        <p class="user-text mt-2">"${item.text}"</p>

                    </div>
                </div>
            `;
        });
    }

    loadHistory();
</script>
{% endblock %}
